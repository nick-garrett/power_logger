<h1>Device State</h1>
<div>Your device is <%= @device.state_as_word %> </div>
<%= link_to(@device.switch_state_word, { :controller => :devices, :action => :toggle_state }, :method => :post, :remote => true) %>

<h1>Readings</h1>

<%= line_chart @readings.all.inject({}) {|res, v| res[0] ||= Hash.new; res[0][v[:created_at]] = v.usage; [res[0], v.usage] }[0] %>

<script language="javascript" type="text/javascript">setTimeout("location.reload();",8000);</script>